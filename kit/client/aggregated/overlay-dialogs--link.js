/* For licensing information see http://contextlysiteimages.contextly.com/_kit/assets/dev/licenses.txt */
!function(a){a(function(){a.support.transition=function(){var a=function(){var c,a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(c in b)if(void 0!==a.style[c])return b[c]}();return a&&{end:a}}()})}(window.jQuery),!function(a){var b=function(b,c){this.options=c,this.$element=a(b).delegate('[data-dismiss="modal"]',"click.dismiss.modal",a.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};b.prototype={constructor:b,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var b=this,c=a.Event("show");this.$element.trigger(c),this.isShown||c.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var c=a.support.transition&&b.$element.hasClass("fade");b.$element.parent().length||b.$element.appendTo(document.body),b.$element.show(),c&&b.$element[0].offsetWidth,b.$element.addClass("in").attr("aria-hidden",!1),b.enforceFocus(),c?b.$element.one(a.support.transition.end,function(){b.$element.focus().trigger("shown")}):b.$element.focus().trigger("shown")}))},hide:function(b){b&&b.preventDefault();b=a.Event("hide"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),a.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var b=this;a(document).on("focusin.modal",function(a){b.$element[0]!==a.target&&!b.$element.has(a.target).length&&b.$element.focus()})},escape:function(){var a=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(b){27==b.which&&a.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var b=this,c=setTimeout(function(){b.$element.off(a.support.transition.end),b.hideModal()},500);this.$element.one(a.support.transition.end,function(){clearTimeout(c),b.hideModal()})},hideModal:function(){var a=this;this.$element.hide(),this.backdrop(function(){a.removeBackdrop(),a.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(b){var d=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var e=a.support.transition&&d;if(this.$backdrop=a('<div class="modal-backdrop '+d+'" />').appendTo(document.body),this.$backdrop.click("static"==this.options.backdrop?a.proxy(this.$element[0].focus,this.$element[0]):a.proxy(this.hide,this)),e&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;e?this.$backdrop.one(a.support.transition.end,b):b()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,b):b()):b&&b()}};var c=a.fn.modal;a.fn.modal=function(c){return this.each(function(){var d=a(this),e=d.data("modal"),f=a.extend({},a.fn.modal.defaults,d.data(),"object"==typeof c&&c);e||d.data("modal",e=new b(this,f)),"string"==typeof c?e[c]():f.show&&e.show()})},a.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},a.fn.modal.Constructor=b,a.fn.modal.noConflict=function(){return a.fn.modal=c,this},a(document).on("click.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d=c.attr("href"),e=a(c.attr("data-target")||d&&d.replace(/.*(?=#[^\s]+$)/,"")),f=e.data("modal")?"toggle":a.extend({remote:!/#/.test(d)&&d},e.data(),c.data());b.preventDefault(),e.modal(f).one("hide",function(){c.focus()})})}(window.jQuery),!function(a){function d(){a(b).each(function(){e(a(this)).removeClass("open")})}function e(b){var d,c=b.attr("data-target");return c||(c=b.attr("href"),c=c&&/#/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,"")),d=c&&a(c),d&&d.length||(d=b.parent()),d}var b="[data-toggle=dropdown]",c=function(b){var c=a(b).on("click.dropdown.data-api",this.toggle);a("html").on("click.dropdown.data-api",function(){c.parent().removeClass("open")})};c.prototype={constructor:c,toggle:function(){var f,g,c=a(this);if(!c.is(".disabled, :disabled"))return f=e(c),g=f.hasClass("open"),d(),g||f.toggleClass("open"),c.focus(),!1},keydown:function(c){var d,f,h,i,j;if(/(38|40|27)/.test(c.keyCode)&&(d=a(this),c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled"))){if(h=e(d),i=h.hasClass("open"),!i||i&&27==c.keyCode)return 27==c.which&&h.find(b).focus(),d.click();f=a("[role=menu] li:not(.divider):visible a",h),f.length&&(j=f.index(f.filter(":focus")),38==c.keyCode&&j>0&&j--,40==c.keyCode&&j<f.length-1&&j++,~j||(j=0),f.eq(j).focus())}}};var f=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var d=a(this),e=d.data("dropdown");e||d.data("dropdown",e=new c(this)),"string"==typeof b&&e[b].call(d)})},a.fn.dropdown.Constructor=c,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=f,this},a(document).on("click.dropdown.data-api",d).on("click.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.dropdown-menu",function(a){a.stopPropagation()}).on("click.dropdown.data-api",b,c.prototype.toggle).on("keydown.dropdown.data-api",b+", [role=menu]",c.prototype.keydown)}(window.jQuery),!function(a){function b(b,c){var f,d=a.proxy(this.process,this),e=a(a(b).is("body")?window:b);this.options=a.extend({},a.fn.scrollspy.defaults,c),this.$scrollElement=e.on("scroll.scroll-spy.data-api",d),this.selector=(this.options.target||(f=a(b).attr("href"))&&f.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=a("body"),this.refresh(),this.process()}b.prototype={constructor:b,refresh:function(){var c,b=this;this.offsets=a([]),this.targets=a([]),c=this.$body.find(this.selector).map(function(){var c=a(this),d=c.data("target")||c.attr("href"),e=/^#\w/.test(d)&&a(d);return e&&e.length&&[[e.position().top+(!a.isWindow(b.$scrollElement.get(0))&&b.$scrollElement.scrollTop()),d]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},process:function(){var g,a=this.$scrollElement.scrollTop()+this.options.offset,b=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,c=b-this.$scrollElement.height(),d=this.offsets,e=this.targets,f=this.activeTarget;if(a>=c)return f!=(g=e.last()[0])&&this.activate(g);for(g=d.length;g--;)f!=e[g]&&a>=d[g]&&(!d[g+1]||a<=d[g+1])&&this.activate(e[g])},activate:function(b){var c,d;this.activeTarget=b,a(this.selector).parent(".active").removeClass("active"),d=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',c=a(d).parent("li").addClass("active"),c.parent(".dropdown-menu").length&&(c=c.closest("li.dropdown").addClass("active")),c.trigger("activate")}};var c=a.fn.scrollspy;a.fn.scrollspy=function(c){return this.each(function(){var d=a(this),e=d.data("scrollspy"),f="object"==typeof c&&c;e||d.data("scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.scrollspy.Constructor=b,a.fn.scrollspy.defaults={offset:10},a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=c,this},a(window).on("load",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);b.scrollspy(b.data())})})}(window.jQuery),!function(a){var b=function(b){this.element=a(b)};b.prototype={constructor:b,show:function(){var e,f,g,b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.attr("data-target");d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),b.parent("li").hasClass("active")||(e=c.find(".active:last a")[0],g=a.Event("show",{relatedTarget:e}),b.trigger(g),g.isDefaultPrevented()||(f=a(d),this.activate(b.parent("li"),c),this.activate(f,f.parent(),function(){b.trigger({type:"shown",relatedTarget:e})})))},activate:function(b,c,d){function g(){e.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),f?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var e=c.find("> .active"),f=d&&a.support.transition&&e.hasClass("fade");f?e.one(a.support.transition.end,g):g(),e.removeClass("in")}};var c=a.fn.tab;a.fn.tab=function(c){return this.each(function(){var d=a(this),e=d.data("tab");e||d.data("tab",e=new b(this)),"string"==typeof c&&e[c]()})},a.fn.tab.Constructor=b,a.fn.tab.noConflict=function(){return a.fn.tab=c,this},a(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(b){b.preventDefault(),a(this).tab("show")})}(window.jQuery),!function(a){var b=function(a,b){this.init("tooltip",a,b)};b.prototype={constructor:b,init:function(b,c,d){var e,f,g,h,i;for(this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.enabled=!0,g=this.options.trigger.split(" "),i=g.length;i--;)h=g[i],"click"==h?this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this)):"manual"!=h&&(e="hover"==h?"mouseenter":"focus",f="hover"==h?"mouseleave":"blur",this.$element.on(e+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(f+"."+this.type,this.options.selector,a.proxy(this.leave,this)));this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(b){return b=a.extend({},a.fn[this.type].defaults,this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},enter:function(b){var e,c=a.fn[this.type].defaults,d={};return this._options&&a.each(this._options,function(a,b){c[a]!=b&&(d[a]=b)},this),e=a(b.currentTarget)[this.type](d).data(this.type),e.options.delay&&e.options.delay.show?(clearTimeout(this.timeout),e.hoverState="in",this.timeout=setTimeout(function(){"in"==e.hoverState&&e.show()},e.options.delay.show),void 0):e.show()},leave:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);return this.timeout&&clearTimeout(this.timeout),c.options.delay&&c.options.delay.hide?(c.hoverState="out",void(this.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide))):c.hide()},show:function(){var b,c,d,e,f,g,h=a.Event("show");if(this.hasContent()&&this.enabled){if(this.$element.trigger(h),h.isDefaultPrevented())return;switch(b=this.tip(),this.setContent(),this.options.animation&&b.addClass("fade"),f="function"==typeof this.options.placement?this.options.placement.call(this,b[0],this.$element[0]):this.options.placement,b.detach().css({top:0,left:0,display:"block"}),this.options.container?b.appendTo(this.options.container):b.insertAfter(this.$element),c=this.getPosition(),d=b[0].offsetWidth,e=b[0].offsetHeight,f){case"bottom":g={top:c.top+c.height,left:c.left+c.width/2-d/2};break;case"top":g={top:c.top-e,left:c.left+c.width/2-d/2};break;case"left":g={top:c.top+c.height/2-e/2,left:c.left-d};break;case"right":g={top:c.top+c.height/2-e/2,left:c.left+c.width}}this.applyPlacement(g,f),this.$element.trigger("shown")}},applyPlacement:function(a,b){var f,g,h,i,c=this.tip(),d=c[0].offsetWidth,e=c[0].offsetHeight;c.offset(a).addClass(b).addClass("in"),f=c[0].offsetWidth,g=c[0].offsetHeight,"top"==b&&g!=e&&(a.top=a.top+e-g,i=!0),"bottom"==b||"top"==b?(h=0,a.left<0&&(h=-2*a.left,a.left=0,c.offset(a),f=c[0].offsetWidth,g=c[0].offsetHeight),this.replaceArrow(h-d+f,f,"left")):this.replaceArrow(g-e,g,"top"),i&&c.offset(a)},replaceArrow:function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},setContent:function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},hide:function(){function e(){var b=setTimeout(function(){c.off(a.support.transition.end).detach()},500);c.one(a.support.transition.end,function(){clearTimeout(b),c.detach()})}var c=this.tip(),d=a.Event("hide");return this.$element.trigger(d),d.isDefaultPrevented()?void 0:(c.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?e():c.detach(),this.$element.trigger("hidden"),this)},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var b=this.$element[0];return a.extend({},"function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},getTitle:function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},tip:function(){return this.$tip=this.$tip||a(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(b){var c=b?a(b.currentTarget)[this.type](this._options).data(this.type):this;c.tip().hasClass("in")?c.hide():c.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var c=a.fn.tooltip;a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data("tooltip"),f="object"==typeof c&&c;e||d.data("tooltip",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.tooltip.Constructor=b,a.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},a.fn.tooltip.noConflict=function(){return a.fn.tooltip=c,this}}(window.jQuery),!function(a){var b=function(a,b){this.init("popover",a,b)};b.prototype=a.extend({},a.fn.tooltip.Constructor.prototype,{constructor:b,setContent:function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content")[this.options.html?"html":"text"](c),a.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var a,b=this.$element,c=this.options;return a=("function"==typeof c.content?c.content.call(b[0]):c.content)||b.attr("data-content")},tip:function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var c=a.fn.popover;a.fn.popover=function(c){return this.each(function(){var d=a(this),e=d.data("popover"),f="object"==typeof c&&c;e||d.data("popover",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.popover.Constructor=b,a.fn.popover.defaults=a.extend({},a.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),a.fn.popover.noConflict=function(){return a.fn.popover=c,this}}(window.jQuery),!function(a){var b=function(b,c){this.options=a.extend({},a.fn.affix.defaults,c),this.$window=a(window).on("scroll.affix.data-api",a.proxy(this.checkPosition,this)).on("click.affix.data-api",a.proxy(function(){setTimeout(a.proxy(this.checkPosition,this),1)},this)),this.$element=a(b),this.checkPosition()};b.prototype.checkPosition=function(){if(this.$element.is(":visible")){var i,b=a(document).height(),c=this.$window.scrollTop(),d=this.$element.offset(),e=this.options.offset,f=e.bottom,g=e.top,h="affix affix-top affix-bottom";"object"!=typeof e&&(f=g=e),"function"==typeof g&&(g=e.top()),"function"==typeof f&&(f=e.bottom()),i=null!=this.unpin&&c+this.unpin<=d.top?!1:null!=f&&d.top+this.$element.height()>=b-f?"bottom":null!=g&&g>=c?"top":!1,this.affixed!==i&&(this.affixed=i,this.unpin="bottom"==i?d.top-c:null,this.$element.removeClass(h).addClass("affix"+(i?"-"+i:"")))}};var c=a.fn.affix;a.fn.affix=function(c){return this.each(function(){var d=a(this),e=d.data("affix"),f="object"==typeof c&&c;e||d.data("affix",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.affix.Constructor=b,a.fn.affix.defaults={offset:0},a.fn.affix.noConflict=function(){return a.fn.affix=c,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var b=a(this),c=b.data();c.offset=c.offset||{},c.offsetBottom&&(c.offset.bottom=c.offsetBottom),c.offsetTop&&(c.offset.top=c.offsetTop),b.affix(c)})})}(window.jQuery),!function(a){var b='[data-dismiss="alert"]',c=function(c){a(c).on("click",b,this.close)};c.prototype.close=function(b){function f(){e.trigger("closed").remove()}var e,c=a(this),d=c.attr("data-target");d||(d=c.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),e=a(d),b&&b.preventDefault(),e.length||(e=c.hasClass("alert")?c:c.parent()),e.trigger(b=a.Event("close")),b.isDefaultPrevented()||(e.removeClass("in"),a.support.transition&&e.hasClass("fade")?e.on(a.support.transition.end,f):f())};var d=a.fn.alert;a.fn.alert=function(b){return this.each(function(){var d=a(this),e=d.data("alert");e||d.data("alert",e=new c(this)),"string"==typeof b&&e[b].call(d)})},a.fn.alert.Constructor=c,a.fn.alert.noConflict=function(){return a.fn.alert=d,this},a(document).on("click.alert.data-api",b,c.prototype.close)}(window.jQuery),!function(a){var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.button.defaults,c)};b.prototype.setState=function(a){var b="disabled",c=this.$element,d=c.data(),e=c.is("input")?"val":"html";a+="Text",d.resetText||c.data("resetText",c[e]()),c[e](d[a]||this.options[a]),setTimeout(function(){"loadingText"==a?c.addClass(b).attr(b,b):c.removeClass(b).removeAttr(b)},0)},b.prototype.toggle=function(){var a=this.$element.closest('[data-toggle="buttons-radio"]');a&&a.find(".active").removeClass("active"),this.$element.toggleClass("active")};var c=a.fn.button;a.fn.button=function(c){return this.each(function(){var d=a(this),e=d.data("button"),f="object"==typeof c&&c;e||d.data("button",e=new b(this,f)),"toggle"==c?e.toggle():c&&e.setState(c)})},a.fn.button.defaults={loadingText:"loading..."},a.fn.button.Constructor=b,a.fn.button.noConflict=function(){return a.fn.button=c,this},a(document).on("click.button.data-api","[data-toggle^=button]",function(b){var c=a(b.target);c.hasClass("btn")||(c=c.closest(".btn")),c.button("toggle")})}(window.jQuery),!function(a){var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.collapse.defaults,c),this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};b.prototype={constructor:b,dimension:function(){var a=this.$element.hasClass("width");return a?"width":"height"},show:function(){var b,c,d,e;if(!this.transitioning&&!this.$element.hasClass("in")){if(b=this.dimension(),c=a.camelCase(["scroll",b].join("-")),d=this.$parent&&this.$parent.find("> .accordion-group > .in"),d&&d.length){if(e=d.data("collapse"),e&&e.transitioning)return;d.collapse("hide"),e||d.data("collapse",null)}this.$element[b](0),this.transition("addClass",a.Event("show"),"shown"),a.support.transition&&this.$element[b](this.$element[0][c])}},hide:function(){var b;!this.transitioning&&this.$element.hasClass("in")&&(b=this.dimension(),this.reset(this.$element[b]()),this.transition("removeClass",a.Event("hide"),"hidden"),this.$element[b](0))},reset:function(a){var b=this.dimension();return this.$element.removeClass("collapse")[b](a||"auto")[0].offsetWidth,this.$element[null!==a?"addClass":"removeClass"]("collapse"),this},transition:function(b,c,d){var e=this,f=function(){"show"==c.type&&e.reset(),e.transitioning=0,e.$element.trigger(d)};this.$element.trigger(c),c.isDefaultPrevented()||(this.transitioning=1,this.$element[b]("in"),a.support.transition&&this.$element.hasClass("collapse")?this.$element.one(a.support.transition.end,f):f())},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var c=a.fn.collapse;a.fn.collapse=function(c){return this.each(function(){var d=a(this),e=d.data("collapse"),f=a.extend({},a.fn.collapse.defaults,d.data(),"object"==typeof c&&c);e||d.data("collapse",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.collapse.defaults={toggle:!0},a.fn.collapse.Constructor=b,a.fn.collapse.noConflict=function(){return a.fn.collapse=c,this},a(document).on("click.collapse.data-api","[data-toggle=collapse]",function(b){var d,c=a(this),e=c.attr("data-target")||b.preventDefault()||(d=c.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""),f=a(e).data("collapse")?"toggle":c.data();c[a(e).hasClass("in")?"addClass":"removeClass"]("collapsed"),a(e).collapse(f)})}(window.jQuery),!function(a){var b=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,"hover"==this.options.pause&&this.$element.on("mouseenter",a.proxy(this.pause,this)).on("mouseleave",a.proxy(this.cycle,this))};b.prototype={cycle:function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},getActiveIndex:function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},to:function(b){var c=this.getActiveIndex(),d=this;if(!(b>this.$items.length-1||0>b))return this.sliding?this.$element.one("slid",function(){d.to(b)}):c==b?this.pause().cycle():this.slide(b>c?"next":"prev",a(this.$items[b]))},pause:function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition.end&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),clearInterval(this.interval),this.interval=null,this},next:function(){return this.sliding?void 0:this.slide("next")},prev:function(){return this.sliding?void 0:this.slide("prev")},slide:function(b,c){var j,d=this.$element.find(".item.active"),e=c||d[b](),f=this.interval,g="next"==b?"left":"right",h="next"==b?"first":"last",i=this;if(this.sliding=!0,f&&this.pause(),e=e.length?e:this.$element.find(".item")[h](),j=a.Event("slide",{relatedTarget:e[0],direction:g}),!e.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var b=a(i.$indicators.children()[i.getActiveIndex()]);b&&b.addClass("active")})),a.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(j),j.isDefaultPrevented())return;e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),this.$element.one(a.support.transition.end,function(){e.removeClass([b,g].join(" ")).addClass("active"),d.removeClass(["active",g].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger("slid")},0)})}else{if(this.$element.trigger(j),j.isDefaultPrevented())return;d.removeClass("active"),e.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return f&&this.cycle(),this}}};var c=a.fn.carousel;a.fn.carousel=function(c){return this.each(function(){var d=a(this),e=d.data("carousel"),f=a.extend({},a.fn.carousel.defaults,"object"==typeof c&&c),g="string"==typeof c?c:f.slide;e||d.data("carousel",e=new b(this,f)),"number"==typeof c?e.to(c):g?e[g]():f.interval&&e.pause().cycle()})},a.fn.carousel.defaults={interval:5e3,pause:"hover"},a.fn.carousel.Constructor=b,a.fn.carousel.noConflict=function(){return a.fn.carousel=c,this},a(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(b){var d,g,c=a(this),e=a(c.attr("data-target")||(d=c.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,"")),f=a.extend({},e.data(),c.data());e.carousel(f),(g=c.attr("data-slide-to"))&&e.data("carousel").pause().to(g).cycle(),b.preventDefault()})}(window.jQuery),!function(a){var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.typeahead.defaults,c),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=a(this.options.menu),this.shown=!1,this.listen()};b.prototype={constructor:b,select:function(){var a=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(a)).change(),this.hide()},updater:function(a){return a},show:function(){var b=a.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:b.top+b.height,left:b.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var c;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(c=a.isFunction(this.source)?this.source(this.query,a.proxy(this.process,this)):this.source,c?this.process(c):this)},process:function(b){var c=this;return b=a.grep(b,function(a){return c.matcher(a)}),b=this.sorter(b),b.length?this.render(b.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(a){return~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){for(var e,b=[],c=[],d=[];e=a.shift();)e.toLowerCase().indexOf(this.query.toLowerCase())?~e.indexOf(this.query)?c.push(e):d.push(e):b.push(e);return b.concat(c,d)},highlighter:function(a){var b=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return a.replace(new RegExp("("+b+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})},render:function(b){var c=this;return b=a(b).map(function(b,d){return b=a(c.options.item).attr("data-value",d),b.find("a").html(c.highlighter(d)),b[0]}),b.first().addClass("active"),this.$menu.html(b),this},next:function(){var c=this.$menu.find(".active").removeClass("active"),d=c.next();d.length||(d=a(this.$menu.find("li")[0])),d.addClass("active")},prev:function(){var b=this.$menu.find(".active").removeClass("active"),c=b.prev();c.length||(c=this.$menu.find("li").last()),c.addClass("active")},listen:function(){this.$element.on("focus",a.proxy(this.focus,this)).on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",a.proxy(this.keydown,this)),this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this)).on("mouseleave","li",a.proxy(this.mouseleave,this))},eventSupported:function(a){var b=a in this.$element;return b||(this.$element.setAttribute(a,"return;"),b="function"==typeof this.$element[a]),b},move:function(a){if(this.shown){switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault(),this.prev();break;case 40:a.preventDefault(),this.next()}a.stopPropagation()}},keydown:function(b){this.suppressKeyPressRepeat=~a.inArray(b.keyCode,[40,38,9,13,27]),this.move(b)},keypress:function(a){this.suppressKeyPressRepeat||this.move(a)},keyup:function(a){switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}a.stopPropagation(),a.preventDefault()},focus:function(){this.focused=!0},blur:function(){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(a){a.stopPropagation(),a.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(b){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),a(b.currentTarget).addClass("active")},mouseleave:function(){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var c=a.fn.typeahead;a.fn.typeahead=function(c){return this.each(function(){var d=a(this),e=d.data("typeahead"),f="object"==typeof c&&c;e||d.data("typeahead",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},a.fn.typeahead.Constructor=b,a.fn.typeahead.noConflict=function(){return a.fn.typeahead=c,this},a(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(){var c=a(this);c.data("typeahead")||c.typeahead(c.data())})}(window.jQuery),function($){function both(a){return"object"==typeof a?a:{top:a,left:a}}var h=$.scrollTo=function(a,b,c){$(window).scrollTo(a,b,c)};h.defaults={axis:"xy",duration:parseFloat($.fn.jquery)>=1.3?0:1,limit:!0},h.window=function(){return $(window)._scrollable()},$.fn._scrollable=function(){return this.map(function(){var a=this,isWin=!a.nodeName||-1!=$.inArray(a.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!isWin)return a;var b=(a.contentWindow||a).document||a.ownerDocument||a;return/webkit/i.test(navigator.userAgent)||"BackCompat"==b.compatMode?b.body:b.documentElement})},$.fn.scrollTo=function(e,f,g){return"object"==typeof f&&(g=f,f=0),"function"==typeof g&&(g={onAfter:g}),"max"==e&&(e=9e9),g=$.extend({},h.defaults,g),f=f||g.duration,g.queue=g.queue&&g.axis.length>1,g.queue&&(f/=2),g.offset=both(g.offset),g.over=both(g.over),this._scrollable().each(function(){function animate(a){$elem.animate(attr,f,g.easing,a&&function(){a.call(this,e,g)})}if(null!=e){var toff,d=this,$elem=$(d),targ=e,attr={},win=$elem.is("html,body");switch(typeof targ){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break}if(targ=$(targ,this),!targ.length)return;case"object":(targ.is||targ.style)&&(toff=(targ=$(targ)).offset())}$.each(g.axis.split(""),function(i,a){var b="x"==a?"Left":"Top",pos=b.toLowerCase(),key="scroll"+b,old=d[key],max=h.max(d,a);if(toff)attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]),g.margin&&(attr[key]-=parseInt(targ.css("margin"+b))||0,attr[key]-=parseInt(targ.css("border"+b+"Width"))||0),attr[key]+=g.offset[pos]||0,g.over[pos]&&(attr[key]+=targ["x"==a?"width":"height"]()*g.over[pos]);else{var c=targ[pos];attr[key]=c.slice&&"%"==c.slice(-1)?parseFloat(c)/100*max:c}g.limit&&/^\d+$/.test(attr[key])&&(attr[key]=attr[key]<=0?0:Math.min(attr[key],max)),!i&&g.queue&&(old!=attr[key]&&animate(g.onAfterFirst),delete attr[key])}),animate(g.onAfter)}}).end()},h.max=function(a,b){var c="x"==b?"Width":"Height",scroll="scroll"+c;if(!$(a).is("html,body"))return a[scroll]-$(a)[c.toLowerCase()]();var d="client"+c,html=a.ownerDocument.documentElement,body=a.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[d],body[d])}}(jQuery);var Handlebars={};!function(Handlebars,undefined){Handlebars.VERSION="1.0.0",Handlebars.COMPILER_REVISION=4,Handlebars.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},Handlebars.helpers={},Handlebars.partials={};var toString=Object.prototype.toString,functionType="[object Function]",objectType="[object Object]";Handlebars.registerHelper=function(name,fn,inverse){if(toString.call(name)===objectType){if(inverse||fn)throw new Handlebars.Exception("Arg not supported with multiple helpers");Handlebars.Utils.extend(this.helpers,name)}else inverse&&(fn.not=inverse),this.helpers[name]=fn},Handlebars.registerPartial=function(name,str){toString.call(name)===objectType?Handlebars.Utils.extend(this.partials,name):this.partials[name]=str},Handlebars.registerHelper("helperMissing",function(arg){if(2===arguments.length)return undefined;throw new Error("Missing helper: '"+arg+"'")}),Handlebars.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse||function(){},fn=options.fn,type=toString.call(context);return type===functionType&&(context=context.call(this)),context===!0?fn(this):context===!1||null==context?inverse(this):"[object Array]"===type?context.length>0?Handlebars.helpers.each(context,options):inverse(this):fn(context)}),Handlebars.K=function(){},Handlebars.createFrame=Object.create||function(object){Handlebars.K.prototype=object;var obj=new Handlebars.K;return Handlebars.K.prototype=null,obj},Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(level,obj){if(Handlebars.logger.level<=level){var method=Handlebars.logger.methodMap[level];"undefined"!=typeof console&&console[method]&&console[method].call(console,obj)
}}},Handlebars.log=function(level,obj){Handlebars.logger.log(level,obj)},Handlebars.registerHelper("each",function(context,options){var data,fn=options.fn,inverse=options.inverse,i=0,ret="",type=toString.call(context);if(type===functionType&&(context=context.call(this)),options.data&&(data=Handlebars.createFrame(options.data)),context&&"object"==typeof context)if(context instanceof Array)for(var j=context.length;j>i;i++)data&&(data.index=i),ret+=fn(context[i],{data:data});else for(var key in context)context.hasOwnProperty(key)&&(data&&(data.key=key),ret+=fn(context[key],{data:data}),i++);return 0===i&&(ret=inverse(this)),ret}),Handlebars.registerHelper("if",function(conditional,options){var type=toString.call(conditional);return type===functionType&&(conditional=conditional.call(this)),!conditional||Handlebars.Utils.isEmpty(conditional)?options.inverse(this):options.fn(this)}),Handlebars.registerHelper("unless",function(conditional,options){return Handlebars.helpers["if"].call(this,conditional,{fn:options.inverse,inverse:options.fn})}),Handlebars.registerHelper("with",function(context,options){var type=toString.call(context);return type===functionType&&(context=context.call(this)),Handlebars.Utils.isEmpty(context)?void 0:options.fn(context)}),Handlebars.registerHelper("log",function(context,options){var level=options.data&&null!=options.data.level?parseInt(options.data.level,10):1;Handlebars.log(level,context)});var errorProps=["description","fileName","lineNumber","message","name","number","stack"];Handlebars.Exception=function(){for(var tmp=Error.prototype.constructor.apply(this,arguments),idx=0;idx<errorProps.length;idx++)this[errorProps[idx]]=tmp[errorProps[idx]]},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(string){this.string=string},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},badChars=/[&<>"'`]/g,possible=/[&<>"'`]/,escapeChar=function(chr){return escape[chr]||"&amp;"};Handlebars.Utils={extend:function(obj,value){for(var key in value)value.hasOwnProperty(key)&&(obj[key]=value[key])},escapeExpression:function(string){return string instanceof Handlebars.SafeString?string.toString():null==string||string===!1?"":(string=string.toString(),possible.test(string)?string.replace(badChars,escapeChar):string)},isEmpty:function(value){return value||0===value?"[object Array]"===toString.call(value)&&0===value.length?!0:!1:!0}},Handlebars.VM={template:function(templateSpec){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];return data?programWrapper=Handlebars.VM.program(i,fn,data):programWrapper||(programWrapper=this.programs[i]=Handlebars.VM.program(i,fn)),programWrapper},merge:function(param,common){var ret=param||common;return param&&common&&(ret={},Handlebars.Utils.extend(ret,common),Handlebars.Utils.extend(ret,param)),ret},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop,compilerInfo:null};return function(context,options){options=options||{};var result=templateSpec.call(container,Handlebars,context,options.helpers,options.partials,options.data),compilerInfo=container.compilerInfo||[],compilerRevision=compilerInfo[0]||1,currentRevision=Handlebars.COMPILER_REVISION;if(compilerRevision!==currentRevision){if(currentRevision>compilerRevision){var runtimeVersions=Handlebars.REVISION_CHANGES[currentRevision],compilerVersions=Handlebars.REVISION_CHANGES[compilerRevision];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+compilerInfo[1]+")."}return result}},programWithDepth:function(i,fn,data){var args=Array.prototype.slice.call(arguments,3),program=function(context,options){return options=options||{},fn.apply(this,[context,options.data||data].concat(args))};return program.program=i,program.depth=args.length,program},program:function(i,fn,data){var program=function(context,options){return options=options||{},fn(context,options.data||data)};return program.program=i,program.depth=0,program},noop:function(){return""},invokePartial:function(partial,name,context,helpers,partials,data){var options={helpers:helpers,partials:partials,data:data};if(partial===undefined)throw new Handlebars.Exception("The partial "+name+" could not be found");if(partial instanceof Function)return partial(context,options);if(Handlebars.compile)return partials[name]=Handlebars.compile(partial,{data:data!==undefined}),partials[name](context,options);throw new Handlebars.Exception("The partial "+name+" could not be compiled when running in runtime-only mode")}},Handlebars.template=Handlebars.VM.template}(Handlebars),Handlebars.registerHelper("t",function(text){return text}),Contextly=window.Contextly||{},Contextly.createClass=function(data){var abstracts=data.abstracts||[],statics=data.statics||{},extend=data.extend||[];extend instanceof Array||(extend=[extend]);var constructor;constructor=data.construct?data.construct:extend.length?function(){for(var i=0;i<extend.length;i++)extend[i].apply(this,arguments)}:function(){};var proto={};delete data.construct,delete data.abstracts,delete data.statics,delete data.extend;for(var i=0;i<extend.length;i++){var parent=extend[i];"function"==typeof parent.construct&&parent.construct.call(constructor);for(var p in parent)"function"==typeof parent[p]&&"construct"!=p&&(constructor[p]=parent[p]);for(var p in parent.prototype)"function"==typeof parent.prototype[p]&&"constructor"!=p&&(proto[p]=parent.prototype[p])}if(statics.abstracts)for(var p=0;p<statics.abstracts.length;p++)proto[statics.abstracts[p]]=Contextly.abstractMethod(p);for(var p=0;p<abstracts.length;p++)proto[abstracts[p]]=Contextly.abstractMethod(p);proto.instanceOf=function(_class){if(arguments.length>1){for(var res=!0,i=0;i<arguments.length;i++)res=res&&this.instanceOf(arguments[i]);return res}if(constructor===_class)return!0;for(var i=0;i<extend.length;i++)if(extend[i].prototype.instanceOf.call(this,_class))return!0;return _class===Object};for(var p in data)"function"==typeof data[p]&&(proto[p]=data[p]);for(var p in statics)"function"==typeof statics[p]&&(constructor[p]=statics[p]);return"function"==typeof statics.construct&&statics.construct.call(constructor),constructor.prototype=proto,constructor.fn=proto,constructor},Contextly.abstractMethod=function(name){return function(){throw name?name+" is abstract method.":"Abstract method must not be called directly."}},function($){Contextly.Proxy=Contextly.createClass({proxy:function(func,passContext,passArguments){func.guid||(func.guid=$.guid++);var proxy,self=this;return proxy=passArguments?passContext?function(){return Array.prototype.unshift.call(arguments,this),func.apply(self,arguments)}:function(){return func.apply(self,arguments)}:passContext?function(){return func.call(self,this)}:function(){return func.call(self)},proxy.guid=func.guid,proxy},each:function(collection,func){return $.each(collection,this.proxy(func,!0,!0))},eachElement:function(elements,func){return this.each(elements,function(){return arguments[0]=$(arguments[0]),func.apply(this,arguments)})}})}(jQuery),function($){Contextly.UiRenderer=Contextly.createClass({extend:Contextly.Proxy,construct:function(){this.initElements(),this.initTemplates(),this.registerPartials()},initTemplates:function(){this.templateHandlers=this.getTemplateHandlers()},initElements:function(){this.e={}},getTemplate:function(name){return Contextly.templates[name]||$.error("Missing template "+name),Contextly.templates[name]},alterTemplateVariables:function(){},renderTemplate:function(name,vars,container,method){vars=vars||{},this.alterTemplateVariables(name,vars);var template=this.getTemplate(name),html=template(vars),tmp=document.createElement("div");tmp.innerHTML=html;var elements=$(tmp).contents();return"string"==typeof container&&(this.e[container]||$.error("Container "+container+" not found on "+name+" template rendering."),container=this.e[container]),container&&(method=method||"append",container[method](elements),this.attachTemplateHandlers(name,container,elements)),elements},getTemplateHandlers:function(){return{}},attachTemplateHandlers:function(name,container,elements){this.templateHandlers[name]&&this.each(this.templateHandlers[name],function(handler){handler.call(this,container,elements)})},getPartials:function(){return{}},registerPartials:function(){var map=this.getPartials();for(var partialName in map)if(map[partialName]){var template=this.getTemplate(partialName);Handlebars.registerPartial(partialName,template)}}})}(jQuery),function($){Contextly.overlayDialog=Contextly.overlayDialog||{},Contextly.overlayDialog.Base=Contextly.createClass({extend:Contextly.UiRenderer,construct:function(){Contextly.UiRenderer.call(this),this.connectToParent(),this.initState(),this.renderEditor()},connectToParent:function(){window.parent&&window.parent.jQuery||$.error("Unable to connect to the parent window.");var p$=window.parent.jQuery;this.api=p$(window.parent).triggerHandler("contextlyOverlayReady"),"undefined"==typeof this.api&&$.error("Unable to communicate with the parent window."),this.settings=this.api.getSettings()},getEditorVariables:function(){return{annotations:this.settings.annotations}},renderEditor:function(){this.renderTemplate("editor",this.getEditorVariables(),$("body"))},getPartials:function(){return{inputFields:!0,searchTabs:!0,searchPager:!0}},initState:function(){this.state={inProgress:!1,lockedControls:null,previewUrl:null,scrollTop:0,scrollLeft:0,searchResults:{},searchQuery:""},this.searchTypes={links:{template:"searchResultsLinks",emptyQuery:!1,search:this.proxy(this.performLinksSearchQuery,!1,!0),render:this.proxy(this.renderLinksSearchResults,!1,!0)}},this.indexAnnotations()},alterTemplateVariables:function(name,vars){vars.editor={},vars.settings=this.settings},getTemplateHandlers:function(){return{editor:[this.initHidden,this.findEditorRoot,this.findEditorElements,this.bindEditorEvents,this.initEditor],alert:[this.bindAlertEvents],searchResultsLinks:[this.bindSearchResultsLinksEvents],urlPreview:[this.initHidden,this.findUrlPreviewElements,this.bindUrlPreviewEvents],progressIndicator:[this.findProgressIndicatorElements]}},findProgressIndicatorElements:function(container){this.e.progressIndicator=container.find(".progress-indicator")},showProgressIndicator:function(){this.e.progressIndicator?this.e.progressIndicator.show():this.renderTemplate("progressIndicator",{},$("body")),this.state.inProgress=!0,this.state.lockedControls=this.e.editor.find("button"),this.lockControls(this.state.lockedControls,"global")},hideProgressIndicator:function(){this.e.progressIndicator.hide(),this.state.inProgress=!1,this.state.lockedControls&&(this.unlockControls(this.state.lockedControls,"global"),this.state.lockedControls=null)},lockControls:function(controls,reason){for(var dataKey="contextlyLocked",i=0;i<controls.length;i++){var control=controls.eq(i),reasons=control.data(dataKey);reasons||(reasons={},control.data(dataKey,reasons)),reasons[reason]=!0}controls.attr("disabled","disabled")},unlockControls:function(controls,reason){for(var i=0;i<controls.length;i++){var control=controls.eq(i),reasons=control.data("contextlyLocked");reasons&&delete reasons[reason],$.isEmptyObject(reasons)&&(control.removeData("contextlyLocked"),control.removeAttr("disabled"))}},initHidden:function(container){container.find(".hidden").css("display","none").removeClass("hidden")},findEditorRoot:function(container){this.e.editor=container.find(".contextly-editor")},findEditorElements:function(container){this.e.searchInput=this.e.editor.find(".search-phrase"),this.e.searchSubmit=this.e.editor.find(".search-submit"),this.e.urlInput=this.e.editor.find(".link-url"),this.e.urlSubmit=this.e.editor.find(".url-submit"),this.e.searchTabs=this.e.editor.find(".search-tabs"),this.e.searchOutput=this.e.editor.find(".search-output"),this.e.searchPager=container.find(".search-pager"),this.e.searchNext=this.e.searchPager.find(".search-next"),this.e.searchPrev=this.e.searchPager.find(".search-prev")},bindEditorEvents:function(){this.onEnter(this.e.searchInput,this.onSearchSubmit),this.onClick(this.e.searchSubmit,this.onSearchSubmit),this.onEnter(this.e.urlInput,this.onUrlSubmit),this.onClick(this.e.urlSubmit,this.onUrlSubmit);var searchTabLinks=this.e.editor.find(".search-tab-link");this.onClick(searchTabLinks,this.onSearchTabSwitch,!0),this.onClick(this.e.searchNext,this.onSearchNext),this.onClick(this.e.searchPrev,this.onSearchPrev)},initEditor:function(){this.refreshSearchTabs()},bindAlertEvents:function(container,elements){var alertClose=elements.find(".close");this.onClick(alertClose,this.hideAlert,!0)},bindSearchResultsLinksEvents:function(container){var addButton=container.find(".website-add"),testLink=container.find(".website-link");this.onClick(addButton,this.onSearchResultAdd,!0),this.onClick(testLink,this.onSearchResultPreview,!0)},on:function(event,element,func,passArguments){func=this.proxy(func,passArguments,passArguments),element.bind(event,func)},onClick:function(element,func,passArguments){func=this.proxy(func,passArguments,passArguments);var self=this;element.bind("click",function(e){return self.state.inProgress?!1:e.which&&1!=e.which?void 0:func.apply(this,arguments)})},onEnter:function(input,func,passArguments){func=this.proxy(func,passArguments,passArguments);var self=this;input.bind("keypress",function(e){return self.state.inProgress?!1:13==e.which?func.apply(this,arguments):void 0})},displayAlert:function(text,type){type=type||"error";var vars={type:type,text:text},container=this.e.editor;this.renderTemplate("alert",vars,container,"prepend"),this.scrollToTopLeft()},hideAlert:function(closeButton){$(closeButton).unbind("click").closest(".alert").remove()},performAjaxRequest:function(method,params,xhrData){params=this.api.buildAjaxConfig(method,params),params.context=this;var jqXHR=$.ajax(params);xhrData||(xhrData=params.data),jqXHR.contextlyData=xhrData,jqXHR.contextlyMethod=method},getActiveSearchTab:function(){var tabs=this.e.searchTabs.find(".search-tab"),active=tabs.filter(".active");return active.size()?active:tabs.filter('[data-search-type="links"]').first()},createTabSearchInfo:function(tab){var type=tab.attr("data-search-type"),siteUrl=tab.attr("data-site-url");return new Contextly.overlayDialog.SearchInfo(type,siteUrl)},getTabSearchInfo:function(tab){var dataKey="contextlySearchInfo",searchInfo=tab.data(dataKey);return searchInfo||(searchInfo=this.createTabSearchInfo(tab),tab.data(dataKey,searchInfo)),searchInfo},onSearchNext:function(){var searchInfo=this.getTabSearchInfo(this.getActiveSearchTab()),cache=this.state.searchResults,cacheKey=searchInfo.toStr();if(this.isSearchQuerySet(searchInfo)&&cache[cacheKey]&&cache[cacheKey].nextPage){var nextPage=parseInt(cache[cacheKey].page)+1;this.performSearchQuery(searchInfo,this.state.searchQuery,nextPage)}return!1},onSearchPrev:function(){var searchInfo=this.getTabSearchInfo(this.getActiveSearchTab()),cache=this.state.searchResults,cacheKey=searchInfo.toStr();if(this.isSearchQuerySet(searchInfo)&&cache[cacheKey]){var currentPage=parseInt(cache[cacheKey].page);currentPage>1&&this.performSearchQuery(searchInfo,this.state.searchQuery,currentPage-1)}return!1},trim:function(str){return str?str.replace(/^\s+/,"").replace(/\s+$/,""):""},onSearchSubmit:function(){var query=this.trim(this.e.searchInput.val()),searchInfo=this.getTabSearchInfo(this.getActiveSearchTab());(query||this.searchTypes[searchInfo.type].emptyQuery)&&this.performSearchQuery(searchInfo,query,1)},onSearchTabSwitch:function(target,e){e.preventDefault();var tab=$(target).closest(".search-tab");if(!tab.is(".active")){var searchInfo=this.getTabSearchInfo(tab);if(this.isSearchQuerySet(searchInfo)){var cacheKey=searchInfo.toStr();this.state.searchResults[cacheKey]?this.displaySearchResults(searchInfo,this.state.searchResults[cacheKey]):this.performSearchQuery(searchInfo,this.state.searchQuery,1)}}},isSearchQuerySet:function(searchInfo){return this.state.searchQuery?!0:this.searchTypes[searchInfo.type].emptyQuery},performSearchQuery:function(searchInfo,query,page){this.checkSearchType(searchInfo),this.showProgressIndicator(),this.searchTypes[searchInfo.type].search(searchInfo,query,page)},performLinksSearchQuery:function(searchInfo,query,page){this.performAjaxRequest("search",{data:{type:searchInfo.type,query:query,page:page,site_url:searchInfo.siteUrl},success:this.onSearchRequestSuccess,error:this.onSearchRequestError,complete:this.hideProgressIndicator})},escapeSizzleAttrValue:function(value){return value?value.replace('"','\\"'):""},activateTab:function(searchInfo){var tabs=this.e.searchTabs.find(".search-tab");tabs.filter(".active").removeClass("active");var escapedType=this.escapeSizzleAttrValue(searchInfo.type),escapedUrl=this.escapeSizzleAttrValue(searchInfo.siteUrl);tabs.filter('[data-search-type="'+escapedType+'"][data-site-url="'+escapedUrl+'"]:first').addClass("active")},onSearchRequestSuccess:function(data){data.query!==this.state.searchQuery&&(this.state.searchResults={},this.state.searchQuery=data.query);var searchInfo=new Contextly.overlayDialog.SearchInfo(data.type,data.siteUrl),cacheEntry=this.renderSearchResults(searchInfo,data);this.state.searchResults[searchInfo.toStr()]=cacheEntry,this.displaySearchResults(searchInfo,cacheEntry),this.scrollToTopLeft()},scrollToTopLeft:function(){var $window=$(window),scrollTop=$window.scrollTop(),scrollLeft=$window.scrollLeft();0>=scrollTop&&0>=scrollLeft||$window.scrollTo(0,300)},onSearchRequestError:function(){this.displayAlert("Unable to perform search request. Something went wrong.")},displaySearchResults:function(searchInfo,result){if(this.refreshSearchTabs(),this.activateTab(searchInfo),this.e.searchOutput.empty().append(result.elements),!result.empty){var template=this.searchTypes[searchInfo.type].template;this.attachTemplateHandlers(template,this.e.searchOutput,result.elements)}result.empty?this.e.searchPager.hide():(this.refreshPager(result.page,result.nextPage),this.e.searchPager.show())},refreshPager:function(page,nextPage){var prevWrapper=this.e.searchPrev.closest(".previous");parseInt(page)<=1?prevWrapper.not(".disabled").addClass("disabled"):prevWrapper.filter(".disabled").removeClass("disabled");var nextWrapper=this.e.searchNext.closest(".next");nextPage?nextWrapper.filter(".disabled").removeClass("disabled"):nextWrapper.not(".disabled").addClass("disabled")},refreshSearchTabs:function(){var tabs=this.e.searchTabs.find(".search-tab");if(this.state.searchQuery)this.e.searchTabs.show(),tabs.show();else{var visible=!1;this.each(this.searchTypes,function(specs,key){var typeTabs=tabs.filter('[data-search-type="'+this.escapeSizzleAttrValue(key)+'"]');specs.emptyQuery?(typeTabs.show(),visible=!0):typeTabs.hide()}),this.e.searchTabs.toggle(visible)}},checkSearchType:function(searchInfo){this.searchTypes[searchInfo.type]||$.error('Unknown search type "'+searchInfo.type+'" passed.')},renderSearchResults:function(searchInfo,data){this.checkSearchType(searchInfo);var result={page:data.page,nextPage:data.nextPage,empty:!(data.list&&data.list.length)};if(result.empty)result.elements=this.renderTemplate("searchResultsEmpty");else{var items=this.searchTypes[searchInfo.type].render(data.list),list=this.renderTemplate("searchResults");result.elements=list.append(items)}return result},renderLinksSearchResults:function(links){return this.renderTemplate("searchResultsLinks",{links:links})},onUrlSubmit:function(){var url=this.trim(this.e.urlInput.val());return url&&this.performUrlInfoRequest(url),!1},onSearchResultAdd:function(target){var url=$(target).closest(".search-result").attr("data-url");this.addSearchResultUrl(url)},addSearchResultUrl:function(url){this.performUrlInfoRequest(url)},performUrlInfoRequest:function(url){return url?(this.performAjaxRequest("url-info",{data:{url:url},success:this.onUrlInfoRequestSuccess,error:this.onUrlInfoRequestError,complete:this.onUrlInfoRequestComplete}),!0):!1},onUrlInfoRequestSuccess:Contextly.abstractMethod(),onUrlInfoRequestError:Contextly.abstractMethod(),onUrlInfoRequestComplete:function(){},onSearchResultPreview:function(target,e){e.preventDefault(),this.showUrlPreview($(target).attr("href"),{confirm:this.onSearchResultPreviewConfirm})},onSearchResultPreviewConfirm:function(){var url=this.state.previewUrl;this.closeUrlPreview(),this.performUrlInfoRequest(url)},findUrlPreviewElements:function(container){this.e.urlPreview=container.find(".url-preview-overlay"),this.e.urlPreviewFrame=this.e.urlPreview.find(".url-preview-frame"),this.e.urlPreviewLink=this.e.urlPreview.find(".url-preview-link");var buttons=this.e.urlPreview.find(".url-preview-buttons");this.e.urlPreviewButtons={remove:buttons.find(".url-preview-remove"),cancel:buttons.find(".url-preview-cancel"),confirm:buttons.find(".url-preview-confirm")}},bindUrlPreviewEvents:function(){this.onClick(this.e.urlPreviewLink,this.onLinkNewTabPreview,!0)},showUrlPreview:function(url,params){params=$.extend({remove:!1,confirm:!1,cancel:this.closeUrlPreview},params),this.e.urlPreview||this.renderTemplate("urlPreview",{},$("body"));for(var kind in this.e.urlPreviewButtons){var button=this.e.urlPreviewButtons[kind];$.isFunction(params[kind])?(button.show().unbind("click"),this.onClick(button,params[kind])):button.hide()}this.state.previewUrl=url,this.lockEditorScroll(),this.api.setOverlayCloseButtonHandler(this.proxy(this.onPreviewOverlayCloseButton)),this.e.urlPreviewFrame.attr("src",url),this.e.urlPreviewLink.attr("href",url),this.e.urlPreview.show()},lockEditorScroll:function(){var $window=$(window);this.state.scrollTop=$window.scrollTop(),this.state.scrollLeft=$window.scrollLeft(),$("html").css({position:"fixed",top:-this.state.scrollTop,left:-this.state.scrollLeft,width:"100%"})},unlockEditorScroll:function(){$("html").css({position:"static",top:"auto",left:"auto",width:"auto"}),$(window).scrollTop(this.state.scrollTop).scrollLeft(this.state.scrollLeft)},onPreviewOverlayCloseButton:function(){return this.closeUrlPreview(),!1},closeUrlPreview:function(){this.state.previewUrl=null,this.api.setOverlayCloseButtonHandler(null),this.e.urlPreviewFrame.attr("src","about:blank"),this.e.urlPreview.hide(),this.unlockEditorScroll()},onLinkNewTabPreview:function(target,e){e.preventDefault(),window.parent.open($(target).attr("href"))},onTextareaEnter:function(target,e){e.preventDefault()},normalizeSpace:function(text){return text.replace(/\s+/," ").replace(/^\s|\s$/,"")},indexAnnotations:function(){this.relatedHosts={};var hostname=this.extractUrlHostname(this.settings.baseUrl);this.relatedHosts[hostname]=!0;for(var i=0;i<this.settings.annotations.length;i++){var annotation=this.settings.annotations[i];annotation.site_url&&(hostname=this.extractUrlHostname(annotation.site_url),this.relatedHosts[hostname]=!0)}},extractUrlHostname:function(url){return url=this.parseUrl(url),url.hostname.toLowerCase().replace(/^\.+|\.+$/,"").replace(/^w{3}\./,"")},parseUrl:function(url){var link=document.createElement("a");return link.href=url,""==link.host&&(link.href=link.href),link},chooseUrlSection:function(url){var urlHostname=this.extractUrlHostname(url);urlHostname=urlHostname.split(".");for(var i=0;i<=urlHostname.length-2;i++){var urlSegment=urlHostname.slice(i).join(".");if(this.relatedHosts[urlSegment])return"previous"}return"web"},snippetLinkExists:function(sectionName,url){var exists=!1;try{this.each(this.settings.snippet.links[sectionName],function(link){return link.native_url===url?(exists=!0,!1):void 0})}catch(e){}return exists},getSnippetLinkNextPos:function(section){try{var lastPos=0|this.settings.snippet.links[section].slice(-1).shift().pos;return lastPos+1}catch(e){return 1}},t:function(str){return str}}),Contextly.overlayDialog.SearchInfo=Contextly.createClass({construct:function(type,siteUrl){this.type=type,this.siteUrl=siteUrl},toStr:function(){return this.type+":"+this.siteUrl}})}(jQuery),function($){Contextly.overlayDialog.Link=Contextly.createClass({extend:Contextly.overlayDialog.Base,getTemplateHandlers:function(){var handlers=Contextly.overlayDialog.Base.prototype.getTemplateHandlers.apply(this,arguments);return handlers.editor=handlers.editor||[],handlers.editor.push(this.searchPassedText),handlers},alterTemplateVariables:function(name,vars){Contextly.overlayDialog.Base.prototype.alterTemplateVariables.apply(this,arguments),vars.editor.isLink=!0},searchPassedText:function(){var text=this.api.getText();text&&(this.e.searchInput.val(text),this.onSearchSubmit())},onUrlSubmit:function(){var url=this.e.urlInput.val().replace(/^\s+|\s+$/,"");this.applyUrl(url)},addSearchResultUrl:function(url){this.applyUrl(url)},onSearchResultPreviewConfirm:function(){var url=this.state.previewUrl;this.closeUrlPreview(),this.applyUrl(url)},applyUrl:function(url){if(url){var type=this.chooseUrlSection(url);this.snippetLinkExists(type,url)?this.returnUrl(url):this.addSnippetLink({type:type,url:url})}},addSnippetLink:function(data){data.pos=this.getSnippetLinkNextPos(data.type),this.settings.snippet&&"undefined"!=typeof this.settings.snippet.id&&(data.snippet_id=this.settings.snippet.id),this.showProgressIndicator(),this.performAjaxRequest("add-snippet-link",{data:data,success:this.onAddSnippetLinkSuccess,error:this.onAddSnippetLinkError})},onAddSnippetLinkSuccess:function(response){this.api.setSnippet(response.snippet),this.returnUrl(response.url)},onAddSnippetLinkError:function(){this.displayAlert("Unable to add link to the widget. Something went wrong."),this.hideProgressIndicator()},returnUrl:function(url){url&&(this.api.callback({link_url:url,link_title:""}),this.api.closeOverlay())}}),$(function(){new Contextly.overlayDialog.Link})}(jQuery);
//# sourceMappingURL=overlay-dialogs--link.map